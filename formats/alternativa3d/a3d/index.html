<!DOCTYPE html>
<html lang="en">
    <head>
      <script>
	// Hack for scrolling window when linking to anchor tag with fixed nav header
        var shiftWindow = function() { scrollBy(0, -75) };
        window.addEventListener("hashchange", shiftWindow);
        function load() { if (window.location.hash) shiftWindow(); }
      </script>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../../img/favicon.ico">
        <title>A3D - libalternativa</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <link href="../../../css/font-awesome.min.css" rel="stylesheet">
    <link href="../../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/http.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="../../../js/base.js"></script> 
    </head>

    <body class="">

      <nav class="navbar navbar-expand-md navbar-dark bg-dark fixed-top">
	<div class="container">
	<a class="navbar-brand" href="../../..">libalternativa</a>
	<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarsExample04" aria-controls="navbarsExample04" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
	</button>

	<div class="collapse navbar-collapse">
          <!-- Main navigation -->
          <nav class="nav">
            <ul class="navbar-nav">
              <li >
                <a class="nav-link" href="../../..">Home</a>
              </li>
              <li class="nav-item dropdown">
                <a href="#" role="button" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" id="nav-dropdown-Tanki Online">Tanki Online <b class="caret"></b></a>
                <div class="dropdown-menu" aria-labelledby="nav-dropdown-Tanki Online">
                  
<a href="../../tanki/a3d/" class="dropdown-item">A3D</a>
                  
<a href="../../tanki/battlemap/" class="dropdown-item">BattleMap</a>
                  
<a href="../../tanki/lightmapdata/" class="dropdown-item">LightmapData</a>
                  
<a href="../../tanki/tara/" class="dropdown-item">Tara</a>
                </div>
              </li>
              <li class="nav-item dropdown active">
                <a href="#" role="button" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" id="nav-dropdown-Alternativa3D">Alternativa3D <b class="caret"></b></a>
                <div class="dropdown-menu" aria-labelledby="nav-dropdown-Alternativa3D">
                  
<a href="./" class="dropdown-item active">A3D</a>
                </div>
              </li>
            </ul>
          </nav>

          <ul class="navbar-nav flex-row ml-md-auto d-none d-md-flex">
            <li class="nav-item">
              <a class="nav-link" href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
		<i class="fa fa-search"></i> Search
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="https://github.com/Pyogenics/libalternativa/tree/master/docs/formats/alternativa3d/a3d.md"><i class="fa fa-github"></i> Edit on GitHub</a>
            </li>
          </ul>
	</div>
	</div>
      </nav><div id="content" class="container">
        
      <div class="row">
        <div class="col-md-9" role="main">


<nav aria-label="breadcrumb">
  <ol class="breadcrumb">
    
    
    <li class="breadcrumb-item">Alternativa3D</li>
    
    
    <li class="breadcrumb-item active" aria-current="page">A3D</li>
  </ol>
</nav>


<h1 id="a3d-alternativa3d">A3D (Alternativa3D)</h1>
<p>There are currently 2 major versions of the A3D format: A3D1 and A3D2 which are supported by the latest flash release of the Alternativa3D engine (8.32.0), this format is not related to the modern A3D format used in Tanki Online.</p>
<h2 id="a3d1">A3D1</h2>
<p>Oldest version of the format, uses the alternativa protocol serialisation format.</p>
<h3 id="research-materials">Research materials</h3>
<ul>
<li><a href="https://github.com/AlternativaPlatform/Alternativa3D/blob/master/src/alternativa/engine3d/loaders/ParserA3D.as">Alternativa3D engine parser</a></li>
</ul>
<h3 id="format">Format</h3>
<pre><code class="language-c">struct A3D1
{
    short version; // 1
    short unused;  // 0
    OptionalMask optionalMask;
    A3D1Box boxes[];            // Optional
    A3D1Geometry geometry[];    // Optional
    A3D1Image images[];         // Optional
    A3D1Map maps[];             // Optional
    A3D1Material materials[];   // Optional
    A3D1Object objects[];       // Optional
};
</code></pre>
<h4 id="a3d1box">A3D1Box</h4>
<pre><code class="language-c">struct A3D1Box
{
    float bounds[];     // Optional
    int id;             // Optional
};
</code></pre>
<h4 id="a3d1geometry">A3D1Geometry</h4>
<pre><code class="language-c">struct A3D1Geometry
{
    int id;                             // Optional
    A3D1IndexBuffer indexBuffer;        // Optional
    A3D1VertexBuffer vertexBuffers[];   // Optional
};
</code></pre>
<h4 id="a3d1image">A3D1Image</h4>
<pre><code class="language-c">struct A3D1Image
{
    int id;         // Optional
    char url[];     // Optional
};
</code></pre>
<h4 id="a3d1map">A3D1Map</h4>
<pre><code class="language-c">struct A3D1Map
{
    short channel;  // Required
    int id;         // Optional
    int imageID;    // Optional
    float uOffset;  // Optional
    float uScale;   // Optional
    float vOffset;  // Optional
    float vScale;   // Optional
};
</code></pre>
<h4 id="a3d1material">A3D1Material</h4>
<pre><code class="language-c">struct A3D1Material
{
    int diffuseMapID;       // Optional
    int glossinessMapID;    // Optional
    int id;                 // Optional
    int lightMapID;         // Optional
    int normalMapID;        // Optional
    int opacityMapID;       // Optional
    int specularMapID;      // Optional
};
</code></pre>
<h4 id="a3d1object">A3D1Object</h4>
<pre><code class="language-c">struct A3D1Object
{
    int boundBoxID;             // Optional
    int geometryID;             // Optional
    int id;                     // Optional
    char name[];                // Optional
    int parentID;               // Optional
    A3D1Surface surfaces[];     // Optional
    A3D1Transform transform;    // Optional
    bool visible;               // Optional
};
</code></pre>
<h4 id="a3d1transform">A3D1Transform</h4>
<pre><code class="language-c">struct A3D1Transform
{
    A3DMatrix matrix;   // Optional
};
</code></pre>
<h4 id="a3d1indexbuffer">A3D1IndexBuffer</h4>
<pre><code class="language-c">struct A3D1IndexBuffer
{
    char byteBuffer[];  // Optional
    int indexCount;     // Required
};
</code></pre>
<h4 id="a3d1vertexbuffer">A3D1VertexBuffer</h4>
<pre><code class="language-c">struct A3D1VertexBuffer
{
    char attributes[];  // Optional
    char byteBuffer[];  // Optional
    short vertexCount;  // Required
};
</code></pre>
<h5 id="attributes">attributes</h5>
<p>The <code>attributes</code> field specifies the format of each vertex inside the <code>byteBuffer</code>, there can be any amount of attributes in any order. It is read as 1 byte integers which each correspond to one of the vertex types:</p>
<pre><code>0 - position
1 - normal
2 - tangent
3 - joint
4 - UV1
5 - UV2
</code></pre>
<h4 id="a3d1surface">A3D1Surface</h4>
<pre><code class="language-c">struct A3D1Surface
{
    int indexBegin;     // Required
    int materialID;     // Optional
    int numTriangles;   // Required
};
</code></pre>
<h2 id="a3d2">A3D2</h2>
<p>Newest version supported by the opensource flash Alternativa3D engine, also uses the alternativa protocol serialisation format (like A3D1). This version of the format adds zlib compression support, light objects, animation, skinning, sprites and decals as well as reducing amount of optional flags per model by properly using optional fields (only marking select fields as optional instead of most of them).</p>
<p>There are 4 minor versions of this format:</p>
<table>
<thead>
<tr>
<th>Version</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>2.0</td>
<td></td>
</tr>
<tr>
<td>2.4</td>
<td>aka A3DExtra1, adds A3D2Layer</td>
</tr>
<tr>
<td>2.5</td>
<td>aka A3DExtra2, adds A3D2Camera, A3D2LOD</td>
</tr>
<tr>
<td>2.6</td>
<td>Package compression is mandatory</td>
</tr>
</tbody>
</table>
<h3 id="research-materials_1">Research materials</h3>
<ul>
<li><a href="https://github.com/AlternativaPlatform/Alternativa3D/blob/master/src/alternativa/engine3d/loaders/ParserA3D.as">Alternativa3D engine parser</a></li>
<li><a href="">Official design document</a></li>
</ul>
<h3 id="format_1">Format</h3>
<pre><code class="language-c">struct A3D2
{
    A3D2Package package;
};
</code></pre>
<h4 id="a3d2package">A3D2Package</h4>
<p>The A3D2 is wrapped in a compressable block called the package, it is placed at the very start of the file and begins with a length field, this is followed by a stream of bytes (size of the length field) which contains the A3D2 data (could be zlib compressed, this is encoded in the length field).</p>
<h5 id="short-package">Short package</h5>
<pre><code>0G000000 00000000
</code></pre>
<table>
<thead>
<tr>
<th>G</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>Package data is not compressed</td>
</tr>
<tr>
<td>1</td>
<td>Package data is compressed</td>
</tr>
</tbody>
</table>
<p>Length of the package is contained in the last 6 bits of the first byte + the next byte, resulting in a maximum length of 16,384 bytes.</p>
<h5 id="long-package">Long package</h5>
<pre><code>10000000 00000000 00000000 00000000
</code></pre>
<p>Length of the package is contained in the last 7 bits of the first byte + the next 3 bytes, resulting in a maximum length of 2147483648 bytes. Compression is assumed to be true.</p>
<h5 id="data">Data</h5>
<p>The uncompressed package data stores the actual file data:</p>
<pre><code class="language-c">struct A3D2Package
{
    OptionalMask optionalMask;
    A3D2AmbientLight ambientLights[];           // Optional
    A3D2AnimationClip animationClips[];         // Optional
    A3D2AnimationTrack animationTracks[];       // Optional
    A3D2Box boxes[];                            // Optional
    A3D2CubeMap cubeMaps[];                     // Optional
    A3D2Decal decals[];                         // Optional
    A3D2DirectionalLight directionalLights[];   // Optional
    A3D2Image images[];                         // Optional
    A3D2IndexBuffer indexBuffers[];             // Optional
    A3D2Joint joints[];                         // Optional
    A3D2Map maps[];                             // Optional
    A3D2Material materials[];                   // Optional
    A3D2Mesh meshes[];                          // Optional
    A3D2Object objects[];                       // Optional
    A3D2OmniLight omniLights[];                 // Optional
    A3D2SpotLight spotLights[];                 // Optional
    A3D2Sprite sprites[];                       // Optional
    A3D2Skin skins[];                           // Optional
    A3D2VertexBuffer vertexBuffers[];           // Optional
    A3D2Layer layers[];                         // Optional, 2.4 only
    A3D2Camera cameras[];                       // Optional, 2.5 only
    A3D2LOD LODs[];                             // Optional, 2.5 only
};
</code></pre>
<h4 id="a3d2ambientlight">A3D2AmbientLight</h4>
<h4 id="a3d2animationclip">A3D2AnimationClip</h4>
<h4 id="a3d2animationtrack">A3D2AnimationTrack</h4>
<h4 id="a3d2box">A3D2Box</h4>
<h4 id="a3d2cubemap">A3D2CubeMap</h4>
<h4 id="a3d2decal">A3D2Decal</h4>
<h4 id="a3d2directionallight">A3D2DirectionalLight</h4>
<h4 id="a3d2image">A3D2Image</h4>
<h4 id="a3d2indexbuffer">A3D2IndexBuffer</h4>
<h4 id="a3d2joint">A3D2Joint</h4>
<h4 id="a3d2map">A3D2Map</h4>
<h4 id="a3d2material">A3D2Material</h4>
<h4 id="a3d2mesh">A3D2Mesh</h4>
<h4 id="a3d2object">A3D2Object</h4>
<h4 id="a3d2omnilight">A3D2OmniLight</h4>
<h4 id="a3d2spotlight">A3D2SpotLight</h4>
<h4 id="a3d2sprite">A3D2Sprite</h4>
<h4 id="a3d2skin">A3D2Skin</h4>
<h4 id="a3d2vertexbuffer">A3D2VertexBuffer</h4>
<h4 id="a3d2layer">A3D2Layer</h4>
<h4 id="a3d2camera">A3D2Camera</h4>
<h4 id="a3d2lod">A3D2LOD</h4>

<ul class="metadata page-metadata" data-bi-name="page info" lang="en-us" dir="ltr">
  <li class="last-updated-holder displayDate loading">
    <span class="last-updated-text">Last updated:</span>
    <time role="presentation" datetime="2018-10-25T00:00:00.000Z" data-article-date-source="ms.date"></time>
  </li>
<!--
  <li class="readingTime">
    2 minutes to read
  </li>
-->
  <li class="contributors-holder">
    <span class="contributors-text">Contributors</span>
    <ul class="contributors" data-bi-name="contributors"><li><a href="" title="Pyogenics" data-bi-name="contributorprofile"><img src="../img/contributor.svg" data-src="https://avatars.githubusercontent.com/u/82675800?v=4?size=32" alt="Pyogenics"></a></li></ul>
  </li>
</ul>
</div>
        <div class="col-md-3"><div class="navbar-light navbar-expand-md hidden-print sticky-top sticky-offset" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    <div id="toc-collapse" class="navbar-collapse collapse card">
        <ul class="nav flex-column bs-sidenav">
            <li class="nav-item main"><a class="nav-link" href="#a3d-alternativa3d">A3D (Alternativa3D)</a></li>
                <li class="nav-item">
                    <a href="#a3d1" class="nav-link">A3D1</a>
                </li>
                <li class="nav-item">
                    <a href="#a3d2" class="nav-link">A3D2</a>
                </li>
        </ul>
    </div>
</div></div>
      </div>
      </div>

      <footer class="col-md-12">
	<hr>
	<div class="container">
	</div>
      </footer>
      <script>
	var base_url = "../../..",
            shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
      </script>
      <script src="../../../js/base.js" defer></script>
      <script src="../../../search/main.js" defer></script>

      <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="Keyboard Shortcuts Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <p class="h4 modal-title">Keyboard Shortcuts</p>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
